<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Add New Asset</title>
    <style>
        /* (same styles as your original; kept for brevity) */
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        body{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;display:flex;justify-content:center;align-items:center}
        .container{max-width:900px;width:100%;background:white;border-radius:20px;box-shadow:0 25px 50px rgba(0,0,0,0.2);overflow:hidden}
        .header{background:linear-gradient(135deg,#2c3e50,#34495e);color:white;padding:40px;text-align:center}
        .header h1{font-size:2.8em;margin-bottom:15px;font-weight:700}
        .header p{opacity:.9;font-size:1.2em;font-weight:300}
        .form-container{padding:40px}
        .form-section{background:#f8f9fa;padding:35px;border-radius:15px;border:3px solid #e9ecef}
        .form-section h2{color:#2c3e50;margin-bottom:30px;font-size:1.8em;text-align:center;font-weight:600}
        .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:25px}
        @media(max-width:768px){.form-grid{grid-template-columns:1fr}}
        .form-group{margin-bottom:25px}
        .form-group.full-width{grid-column:1 / -1}
        .form-group label{display:block;margin-bottom:10px;font-weight:600;color:#495057;font-size:1.1em}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:15px;border:2px solid #dee2e6;border-radius:10px;font-size:16px;transition:all .3s ease;background:white}
        .form-group textarea{resize:vertical;min-height:80px;font-family:inherit}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 4px rgba(102,126,234,.15);transform:translateY(-2px)}
        .imei-section{background:#e8f4fd;padding:20px;border-radius:10px;margin-top:10px;border-left:5px solid #2196F3}
        .imei-section input{margin-bottom:12px}
        .imei-section input:last-child{margin-bottom:0}
        .btn-group{display:flex;gap:15px;margin-top:35px;grid-column:1 / -1}
        .btn{padding:18px 30px;border:none;border-radius:12px;font-size:18px;font-weight:600;cursor:pointer;transition:all .3s ease;flex:1;text-transform:uppercase;letter-spacing:1px}
        .btn-primary{background:linear-gradient(135deg,#0078d4,#005a9e);color:white;box-shadow:0 5px 15px rgba(0,120,212,.3)}
        .btn-primary:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,120,212,.4)}
        .btn-secondary{background:linear-gradient(135deg,#6c757d,#5a6268);color:white;box-shadow:0 5px 15px rgba(108,117,125,.3)}
        .btn-secondary:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(108,117,125,.4)}
        .btn-excel{background:linear-gradient(135deg,#217346,#107c41);color:white;box-shadow:0 5px 15px rgba(33,115,70,.3)}
        .btn-excel:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(33,115,70,.4)}
        .required::after{content:" *";color:#e74c3c}
        .success-message{background:linear-gradient(135deg,#d4edda,#c3e6cb);color:#155724;padding:20px;border-radius:10px;margin-top:20px;text-align:center;font-weight:600;font-size:1.1em;border-left:5px solid #28a745;display:none}
        .error-message{background:linear-gradient(135deg,#f8d7da,#f5c6cb);color:#721c24;padding:20px;border-radius:10px;margin-top:20px;text-align:center;font-weight:600;font-size:1.1em;border-left:5px solid #dc3545;display:none}
        .form-group small{display:block;margin-top:8px;color:#6c757d;font-size:.9em}
        .loading{display:none;text-align:center;margin:20px 0}
        .spinner{border:4px solid #f3f3f3;border-top:4px solid #0078d4;border-radius:50%;width:40px;height:40px;animation:spin 2s linear infinite;margin:0 auto}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .excel-link{text-align:center;margin-top:20px;padding:15px;background:#e7f3ff;border-radius:10px;border-left:5px solid #0078d4}
        .data-preview{background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;border:2px solid #dee2e6;display:none}
        .data-preview h3{color:#2c3e50;margin-bottom:15px}
        .preview-table{width:100%;border-collapse:collapse}
        .preview-table th,.preview-table td{padding:10px;border:1px solid #dee2e6;text-align:left}
        .preview-table th{background:#0078d4;color:white}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Add New Asset</h1>
            <p>Fill asset details and save ‚Äî data stored in browser localStorage and downloadable as CSV for Excel.</p>
        </div>

        <div class="form-container">
            <div class="form-section">
                <div class="excel-link" id="excelLink" style="display: none;">
                    <p>üìä <strong>Data ready for Excel 365!</strong></p>
                    <button type="button" class="btn btn-excel" onclick="downloadExcel()" style="padding: 10px 20px; margin-top: 10px;">
                        üì• Download Excel File
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="copyToClipboard()" style="padding: 10px 20px; margin-top: 10px;">
                        üìã Copy Data for Excel
                    </button>
                </div>

                <!-- Data Preview -->
                <div class="data-preview" id="dataPreview">
                    <h3>üìä Data Preview (Ready for Excel)</h3>
                    <table class="preview-table" id="previewTable">
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="previewBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <form id="assetForm">
                    <div class="form-grid">
                        <!-- Asset Code -->
                        <div class="form-group">
                            <label for="assetCode" class="required">Asset Code / Serial Number</label>
                            <input type="text" id="assetCode" required placeholder="e.g., AMD-LAP-001">
                            <small>Unique identifier for the asset</small>
                        </div>

                        <!-- Asset Type -->
                        <div class="form-group">
                            <label for="assetType" class="required">Asset Type</label>
                            <select id="assetType" required>
                                <option value="">Select Asset Type</option>
                                <option value="Laptop">üíª Laptop</option>
                                <option value="Mobile">üì± Mobile</option>
                                <option value="Tablet">üìü Tablet</option>
                                <option value="Desktop">üñ•Ô∏è Desktop</option>
                                <option value="Monitor">üñ•Ô∏è Monitor</option>
                                <option value="Printer">üñ®Ô∏è Printer</option>
                                <option value="Other">üîß Other</option>
                            </select>
                        </div>

                        <!-- Brand & Model -->
                        <div class="form-group">
                            <label for="brandModel" class="required">Brand & Model</label>
                            <input type="text" id="brandModel" required placeholder="e.g., Dell Latitude 5420">
                        </div>

                        <!-- Asset Description -->
                        <div class="form-group">
                            <label for="assetDescription" class="required">Asset Description</label>
                            <textarea id="assetDescription" required placeholder="e.g., Core i7, 16GB RAM, 512GB SSD..."></textarea>
                            <small>Detailed specifications and features</small>
                        </div>

                        <!-- Vendor Name -->
                        <div class="form-group">
                            <label for="vendorName" class="required">Vendor Name</label>
                            <input type="text" id="vendorName" required placeholder="e.g., Amazon, Dell Store, Local Dealer...">
                        </div>

                        <!-- Invoice No -->
                        <div class="form-group">
                            <label for="invoiceNo" class="required">Invoice Number</label>
                            <input type="text" id="invoiceNo" required placeholder="e.g., INV-2024-001">
                        </div>

                        <!-- Operators -->
                        <div class="form-group">
                            <label for="operator" class="required">Operator</label>
                            <select id="operator" required>
                                <option value="">Select Operator</option>
                                <option value="Nikhil">üë§ Nikhil</option>
                                <option value="Nitesh">üë§ Nitesh</option>
                                <option value="Gulam">üë§ Gulam</option>
                            </select>
                        </div>

                        <!-- Assigned Hub -->
                        <div class="form-group">
                            <label for="assignedHub" class="required">Assigned Hub / Location</label>
                            <select id="assignedHub" required>
                                <option value="">Select Location</option>
                                <option value="Ahmedabad">üè¢ Ahmedabad</option>
                                <option value="Indore">üè¢ Indore</option>
                                <option value="Jhansi">üè¢ Jhansi</option>
                                <option value="Mysuru">üè¢ Mysuru</option>
                                <option value="Kochi">üè¢ Kochi</option>
                            </select>
                        </div>

                        <!-- IMEI Section -->
                        <div class="form-group full-width">
                            <label>IMEI / SIM Details (For Mobile/Tablet)</label>
                            <div class="imei-section">
                                <input type="text" id="imei1" placeholder="IMEI 1 Number">
                                <input type="text" id="imei2" placeholder="IMEI 2 Number (if applicable)">
                                <input type="text" id="simNumber" placeholder="SIM / Mobile Number">
                            </div>
                        </div>

                        <!-- Purchase Date -->
                        <div class="form-group">
                            <label for="purchaseDate" class="required">Purchase Date</label>
                            <input type="date" id="purchaseDate" required>
                        </div>

                        <!-- Purchase Cost -->
                        <div class="form-group">
                            <label for="purchaseCost" class="required">Purchase Cost / Value (‚Çπ)</label>
                            <input type="number" id="purchaseCost" required placeholder="e.g., 65000" min="0" step="0.01">
                        </div>

                        <!-- Current Status -->
                        <div class="form-group">
                            <label for="currentStatus" class="required">Current Status</label>
                            <select id="currentStatus" required>
                                <option value="Available">‚úÖ Available</option>
                                <option value="Assigned">üë§ Assigned</option>
                                <option value="In Store">üè™ In Store</option>
                                <option value="Under Repair">üîß Under Repair</option>
                                <option value="Scrap">üóëÔ∏è Scrap</option>
                            </select>
                        </div>

                        <!-- Condition -->
                        <div class="form-group">
                            <label for="condition" class="required">Condition</label>
                            <select id="condition" required>
                                <option value="New">New</option>
                                <option value="Refurbished">Refurbished</option>
                                <option value="Good">Good</option>
                                <option value="Scrap">Scrap</option>
                            </select>
                        </div>
                    </div>

                    <!-- Loading Spinner -->
                    <div class="loading" id="loadingSpinner">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px;">Processing data for Excel...</p>
                    </div>

                    <!-- Success Message -->
                    <div class="success-message" id="successMessage">
                        ‚úÖ Asset data ready for Microsoft 365 Excel!
                    </div>

                    <!-- Error Message -->
                    <div class="error-message" id="errorMessage">
                        ‚ùå Error processing data. Please try again.
                    </div>

                    <!-- Buttons -->
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">üíæ Save for Excel</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">üîÑ Clear Form</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
    // Store all assets data
    let allAssets = JSON.parse(localStorage.getItem('assets')) || [];

    // Excel template structure and mapping to JS object keys
    const excelHeaders = [
        'Timestamp', 'Asset Code', 'Asset Type', 'Brand & Model',
        'Asset Description', 'Vendor Name', 'Invoice No', 'Operator',
        'Assigned Hub', 'IMEI 1', 'IMEI 2', 'SIM Number', 'Purchase Date',
        'Purchase Cost', 'Current Status', 'Condition'
    ];

    // Map header -> object key (camelCase keys used in JS object)
    const headerToKey = {
        'Timestamp': 'timestamp',
        'Asset Code': 'assetCode',
        'Asset Type': 'assetType',
        'Brand & Model': 'brandModel',
        'Asset Description': 'assetDescription',
        'Vendor Name': 'vendorName',
        'Invoice No': 'invoiceNo',
        'Operator': 'operator',
        'Assigned Hub': 'assignedHub',
        'IMEI 1': 'imei1',
        'IMEI 2': 'imei2',
        'SIM Number': 'simNumber',
        'Purchase Date': 'purchaseDate',
        'Purchase Cost': 'purchaseCost',
        'Current Status': 'currentStatus',
        'Condition': 'condition'
    };

    // Initialize the form
    document.addEventListener('DOMContentLoaded', function() {
        // Set today's date as default for purchase date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('purchaseDate').value = today;

        // Form submission
        document.getElementById('assetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveForExcel();
        });

        // Auto-generate asset code based on type and hub
        document.getElementById('assetType').addEventListener('change', generateAssetCode);
        document.getElementById('assignedHub').addEventListener('change', generateAssetCode);
    });

    // Generate asset code automatically
    function generateAssetCode() {
        const assetType = document.getElementById('assetType').value;
        const hub = document.getElementById('assignedHub').value;
        const assetCodeField = document.getElementById('assetCode');

        if (assetType && hub && !assetCodeField.value) {
            const hubCode = getHubCode(hub);
            const typeCode = getTypeCode(assetType);
            const randomNum = Math.floor(Math.random() * 900) + 100; // 100-999

            assetCodeField.value = `${hubCode}-${typeCode}-${randomNum}`;
        }
    }

    // Get hub code
    function getHubCode(hub) {
        const hubCodes = {
            'Ahmedabad': 'AMD',
            'Indore': 'IND',
            'Jhansi': 'JHN',
            'Mysuru': 'MYS',
            'Kochi': 'KOC'
        };
        return hubCodes[hub] || 'HQ';
    }

    // Get type code
    function getTypeCode(type) {
        const typeCodes = {
            'Laptop': 'LAP',
            'Mobile': 'MOB',
            'Tablet': 'TAB',
            'Desktop': 'DES',
            'Monitor': 'MON',
            'Printer': 'PRI',
            'Other': 'OTH'
        };
        return typeCodes[type] || 'AST';
    }

    // Save data for Excel
    function saveForExcel() {
        // collect form values
        const formData = {
            timestamp: new Date().toLocaleString(),
            assetCode: document.getElementById('assetCode').value.trim(),
            assetType: document.getElementById('assetType').value,
            brandModel: document.getElementById('brandModel').value.trim(),
            assetDescription: document.getElementById('assetDescription').value.trim(),
            vendorName: document.getElementById('vendorName').value.trim(),
            invoiceNo: document.getElementById('invoiceNo').value.trim(),
            operator: document.getElementById('operator').value,
            assignedHub: document.getElementById('assignedHub').value,
            imei1: document.getElementById('imei1').value.trim(),
            imei2: document.getElementById('imei2').value.trim(),
            simNumber: document.getElementById('simNumber').value.trim(),
            purchaseDate: document.getElementById('purchaseDate').value,
            purchaseCost: document.getElementById('purchaseCost').value,
            currentStatus: document.getElementById('currentStatus').value,
            condition: document.getElementById('condition').value
        };

        // Show loading spinner
        document.getElementById('loadingSpinner').style.display = 'block';
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('excelLink').style.display = 'none';
        document.getElementById('dataPreview').style.display = 'none';

        try {
            // Basic validation: assetCode optional but ensure required fields present
            if (!formData.assetType || !formData.brandModel || !formData.vendorName) {
                throw new Error('Please fill required fields (Asset Type, Brand & Model, Vendor).');
            }

            // Add to local storage
            allAssets.push(formData);
            localStorage.setItem('assets', JSON.stringify(allAssets));

            // Show data preview
            showDataPreview(formData);

            // Show success message
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('excelLink').style.display = 'block';
            document.getElementById('dataPreview').style.display = 'block';

            // Clear form after successful submission (but keep excelLink available)
            setTimeout(() => {
                clearForm(false); // pass false so excelLink remains for download if user wants
                document.getElementById('dataPreview').style.display = 'none';
            }, 3000);

        } catch (error) {
            console.error('Error:', error);
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('errorMessage').innerHTML = '‚ùå Error: ' + error.message;
        } finally {
            // Hide loading spinner
            document.getElementById('loadingSpinner').style.display = 'none';
        }
    }

    // Show data preview
    function showDataPreview(data) {
        const previewBody = document.getElementById('previewBody');
        previewBody.innerHTML = '';

        Object.entries(data).forEach(([key, value]) => {
            const row = document.createElement('tr');
            const fieldName = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
            row.innerHTML = `
                <td><strong>${fieldName}</strong></td>
                <td>${value || 'N/A'}</td>
            `;
            previewBody.appendChild(row);
        });
    }

    // Download Excel file (CSV)
    function downloadExcel() {
        if (allAssets.length === 0) {
            alert('No data available to download');
            return;
        }

        // Create CSV content using headerToKey mapping
        let csvContent = excelHeaders.join(',') + '\n';

        allAssets.forEach(asset => {
            const row = excelHeaders.map(header => {
                const key = headerToKey[header];
                // replace double quotes inside values, and wrap in quotes
                const val = (asset[key] !== undefined && asset[key] !== null) ? String(asset[key]).replace(/"/g, '""') : '';
                return `"${val}"`;
            });
            csvContent += row.join(',') + '\n';
        });

        // Create and download file
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);

        link.setAttribute('href', url);
        link.setAttribute('download', `Asset_Management_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // Copy data to clipboard for Excel (tab-separated)
    function copyToClipboard() {
        if (allAssets.length === 0) {
            alert('No data available to copy');
            return;
        }

        let excelContent = excelHeaders.join('\t') + '\n';

        allAssets.forEach(asset => {
            const row = excelHeaders.map(header => {
                const key = headerToKey[header];
                return asset[key] || '';
            });
            excelContent += row.join('\t') + '\n';
        });

        navigator.clipboard.writeText(excelContent).then(() => {
            alert('Data copied to clipboard! You can paste it directly into Excel.');
        }).catch(err => {
            console.error('Failed to copy: ', err);
            alert('Failed to copy data. Please try again.');
        });
    }

    // Clear form
    // keepExcelLink default true; if false, do not hide excel link (used after save)
    function clearForm(hideExcelLink = true) {
        document.getElementById('assetForm').reset();
        // Set today's date again after clear
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('purchaseDate').value = today;

        // Hide messages
        document.getElementById('successMessage').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'none';
        if (hideExcelLink) document.getElementById('excelLink').style.display = 'none';
        document.getElementById('dataPreview').style.display = 'none';
    }
</script>
</body>
</html>
